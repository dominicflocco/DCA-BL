# A Heuristic for Complementarity Problems Using Difference of Convex Functions
The software and data in this repository are a snapshot of the software and data
that were used in the research reported on in the paper 
[A Heuristic for Complementarity Problems Using Difference of Convex Functions](https://doi.org/10.1287/ijoc.2024.0822) by S. Gabriel, D. Flocco, T. Boomsma, M. Schmidt and M. Lejeune. 

## Description

The repository contains the implementation of a heuristic for solving linear and nonlinear complementarity problems (LCPs and NCPs) using a difference of convex functions (DC) approach. The method is referred to as DCA-BL (Difference of Convex Function Algorithms for Bilinear Terms). All algorithms are implemented in Python. LCP problem instances are implemented using the Pyomo modeling language, while NCP instances are implemented using gurobipy. The heuristic is based on the DCA framework, which iteratively solves a sequence of convex approximations to the original non-convex problem.

The heuristic is applied to five classes of problems:
1. Randomly generated LCPs `random_lcps`
2. Benchmark LCPs from the literature `benchmark_lcps`
3. Market equilibrium LCPs (price-taker and price-maker models) `market_equilibrium`
4. Multi-portfolio equilibrium NCP `portfolio_opt`
5. Water network equilibrium NCP `water_equilibrium`

Problem generators, data files and results for all problem classes are included in the repository, along with scripts to run the DCA-BL algorithm on each problem class. Each problem class has its own subdirectory under `scripts`, `data` and `results`. Problem generators and the implementation of the DCA-BL algorithm are located in the `src` subdirectory.

See the Readme file in the `data` subdirectory for details on the data file structures for each problem class.

## Environment

The code has been developed and tested in a Python 3.11 environment. It is recommended to use a virtual environment to manage dependencies. The required packages can be installed using the provided `environment.yml` file for conda or `requirements.txt` file for pip. To create a conda environment from the `environment.yml` file, use the following command:

```bash
conda env create -f environment.yml
```
To install the required packages using pip and the `requirements.txt` file, use the following command:

```bash
pip install -r requirements.txt
```

In addition to the packages listed in the `environment.yml` or `requirements.txt` file, a commercial solver is required to solve the convex subproblems generated by the DCA-BL algorithm. The base implementation of the algorithm uses Mosek as the default solver for LCPs and Gurobi as the default for NCPs. Instructions for installing Mosek can be found at [https://docs.mosek.com/latest/install/index.html](https://docs.mosek.com/latest/install/index.html). Instructions for installing Gurobi can be found at [https://www.gurobi.com/academia/academic-program-and-licenses/](https://www.gurobi.com/academia/academic-program-and-licenses/). Other solvers that are compatible with Pyomo and Gurobi can also be used, but may require modifications to the code. For benchmarking, the open-source pathampl solver is used, which can be installed from [https://pages.cs.wisc.edu/~ferris/path.html](https://pages.cs.wisc.edu/~ferris/path.html).

## Results

Results from the computational experiments presented in the paper are included in the `results` subdirectory. Each problem class has its own subdirectory under `results`, which contains the results files.

## Replicating
To replicate the results presented in the paper, use the following commands from the root directory of the repository:

#### Random LCPs
```bash
python scripts/random_lcps/random_lcp.py
```
#### Benchmark LCPs
```bash
python scripts/benchmark_lcps/benchmark_lcps.py
```
#### Market Equilibrium LCPs
```bash
python scripts/market_equilibrium/price_maker_LCP.py
python scripts/market_equilibrium/price_taker_LCP.py
```
#### Multi-Portfolio Equilibrium NCP
```bash
python scripts/portfolio_opt/solve_multiportfolio.py
```
#### Water Network Equilibrium NCP
```bash
python scripts/water_equilibrium/water_equil_dca_model.py
```

## Ongoing Development
This code is being developed on an on-going basis at the author's
[Github site](https://github.com/dominicflocco/DCA-BL).

## Support

For support in using this software, submit an
[issue](https://github.com/dominicflocco/DCA-BL/issues).
